<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Fruit Tumble ‚Äì Demo Slot (No Real Money)</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #2c3e50, #000);
      color: #fff;
      text-align: center;
    }

    .wrapper {
      max-width: 480px;
      margin: 20px auto;
      padding: 10px;
      border-radius: 16px;
      background: rgba(0,0,0,0.4);
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    h1 {
      font-size: 20px;
      margin: 10px 0 5px;
    }
    .subtitle {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .panel {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      margin: 8px 0 12px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
    }
    .panel div {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .bet-controls button {
      border: none;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      background: #34495e;
      color: #fff;
    }
    .bet-controls span {
      min-width: 40px;
      display: inline-block;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 6px;
      margin: 0 auto 12px;
      padding: 8px;
      border-radius: 14px;
      background: linear-gradient(135deg, #1b2735, #090a0f);
    }

    .cell {
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      background: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      position: relative;
      overflow: hidden;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      /* yukarƒ±dan kayma animasyonu */
      transform: translateY(-40px);
      opacity: 0;
      animation: drop 0.25s ease-out forwards;
    }

    @keyframes drop {
      from {
        transform: translateY(-40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .cell.symbol-win {
      background: #3c2b5a;
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    .cell-mult {
      position: absolute;
      bottom: 3px;
      right: 3px;
      padding: 2px 4px;
      border-radius: 999px;
      font-size: 11px;
      background: radial-gradient(circle at top, #f1c40f, #e67e22);
      color: #000;
      font-weight: 700;
      box-shadow: 0 0 6px rgba(241, 196, 15, 0.8);
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
    }

    .spin-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 40px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .spin-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
    }

    .spin-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .buy-btn {
      border: none;
      border-radius: 999px;
      padding: 6px 24px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #e67e22, #f1c40f);
      color: #000;
      box-shadow: 0 3px 10px rgba(0,0,0,0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .buy-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
    }

    .buy-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .info-line {
      font-size: 12px;
      opacity: 0.9;
      min-height: 16px;
    }

    .win-text {
      font-size: 14px;
      margin-top: 2px;
      min-height: 18px;
    }

    .danger {
      color: #e74c3c;
    }

    .ok {
      color: #2ecc71;
    }

    @media (max-width: 520px) {
      .wrapper {
        margin: 0;
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Fruit Tumble</h1>
    <div class="subtitle">
      Tamamen sahte kredi ile eƒülence ama√ßlƒ± DEMO. Ger√ßek para veya ger√ßek bahis i√ßermez.
    </div>

    <div class="panel">
      <div>
        Bakiye:
        <strong id="balance">1000</strong>
        <span>kredi</span>
      </div>
      <div class="bet-controls">
        Bahis:
        <button id="betMinus">‚àí</button>
        <span id="bet">20</span>
        <button id="betPlus">+</button>
      </div>
    </div>

    <div class="panel" style="margin-top: -6px;">
      <div>
        Free Spin:
        <strong id="freeSpins">0</strong>
      </div>
      <div style="font-size:11px; opacity:0.8;">
        4 üéüÔ∏è ‚Üí 10 FS, her ekstra üéüÔ∏è +2 FS &nbsp;|&nbsp; BUY: bahis √ó100 ‚Üí 10 FS
      </div>
    </div>

    <div id="grid" class="grid"></div>

    <div class="controls">
      <button id="spinBtn" class="spin-btn">SPIN</button>
      <button id="buyBtn" class="buy-btn">BUY FREE SPINS (x100)</button>
      <div id="info" class="info-line"></div>
      <div id="winInfo" class="win-text"></div>
    </div>

    <div style="font-size:11px; opacity:0.7; margin-top:6px;">
      Uyarƒ±: Bu sadece bir sim√ºlasyon. Eƒüer ger√ßek kumar oynama isteƒüini tetikliyorsa, kullanmaman daha saƒülƒ±klƒ±.
    </div>
  </div>

  <script>
    // === OYUN AYARLARI ===
    const ROWS = 5;
    const COLS = 6;

    const SYMBOLS = [
      { id: "apple",   emoji: "üçé" },
      { id: "orange",  emoji: "üçä" },
      { id: "cherry",  emoji: "üçí" },
      { id: "gem",     emoji: "üíé" },
      { id: "star",    emoji: "‚≠ê"  },
      { id: "orb",     emoji: "üü£" },
      { id: "coin",    emoji: "üü°" },
      { id: "scatter", emoji: "üéüÔ∏è" } // Free Spin sembol√º
    ];

    const MULTIPLIER_VALUES = [2, 4, 6, 8, 10, 25];
    const MULT_CHANCE_BASE = 0.12;
    const MULT_CHANCE_FREE = 0.20;

    // === STATE ===
    let grid = [];
    let balance = 1000;
    let bet = 20;
    let spinning = false;

    let freeSpins = 0;
    let currentSpinIsFree = false;

    // Free spin serisi takibi (Sweet Bonanza tarzƒ±)
    let freeSpinSessionActive = false;
    let freeSpinSessionTotalWin = 0;

    const elGrid      = document.getElementById("grid");
    const elBalance   = document.getElementById("balance");
    const elBet       = document.getElementById("bet");
    const elSpin      = document.getElementById("spinBtn");
    const elBuy       = document.getElementById("buyBtn");
    const elInfo      = document.getElementById("info");
    const elWinInfo   = document.getElementById("winInfo");
    const elBetMinus  = document.getElementById("betMinus");
    const elBetPlus   = document.getElementById("betPlus");
    const elFreeSpins = document.getElementById("freeSpins");

    function randChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    // Scatter oranƒ± daha d√º≈ü√ºk
    function createRandomCell() {
      const isScatter = Math.random() < 0.04; // %4 scatter

      if (isScatter) {
        const sym = SYMBOLS.find(s => s.id === "scatter");
        return {
          id: sym.id,
          emoji: sym.emoji,
          isMultiplier: false,
          multValue: 0
        };
      }

      const normalSymbols = SYMBOLS.filter(s => s.id !== "scatter");
      const sym = randChoice(normalSymbols);

      return {
        id: sym.id,
        emoji: sym.emoji,
        isMultiplier: false,
        multValue: 0
      };
    }

    function initGrid() {
      grid = [];
      for (let r = 0; r < ROWS; r++) {
        const row = [];
        for (let c = 0; c < COLS; c++) {
          row.push(createRandomCell());
        }
        grid.push(row);
      }
    }

    function renderGrid(winningIds = []) {
      elGrid.innerHTML = "";
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cellData = grid[r][c];
          const cellDiv = document.createElement("div");
          cellDiv.className = "cell";

          const index = r * COLS + c;
          cellDiv.style.animationDelay = (index * 0.02) + "s";

          if (!cellData) {
            elGrid.appendChild(cellDiv);
            continue;
          }

          if (winningIds.includes(cellData.id) &&
              !cellData.isMultiplier &&
              cellData.id !== "scatter") {
            cellDiv.classList.add("symbol-win");
          }

          cellDiv.textContent = cellData.emoji;

          if (cellData.isMultiplier && cellData.multValue > 0) {
            const multDiv = document.createElement("div");
            multDiv.className = "cell-mult";
            multDiv.textContent = "x" + cellData.multValue;
            cellDiv.appendChild(multDiv);
          }

          elGrid.appendChild(cellDiv);
        }
      }
    }

    function updateUI() {
      elBalance.textContent = balance;
      elBet.textContent = bet;
      elFreeSpins.textContent = freeSpins;

      const cost = bet * 100;
      if (spinning || balance < cost) {
        elBuy.disabled = true;
      } else {
        elBuy.disabled = false;
      }
    }

    function wait(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function countScatters() {
      let scatters = 0;
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = grid[r][c];
          if (cell && cell.id === "scatter") {
            scatters++;
          }
        }
      }
      return scatters;
    }

    function findWinningSymbols() {
      const counts = {};
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = grid[r][c];
          if (!cell || cell.isMultiplier) continue;
          if (cell.id === "scatter") continue;
          counts[cell.id] = (counts[cell.id] || 0) + 1;
        }
      }
      const winnerIds = Object.keys(counts).filter(id => counts[id] >= 8);
      return { winnerIds };
    }

    function removeWinningSymbols(winnerIds) {
      let removed = 0;
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = grid[r][c];
          if (!cell) continue;
          if (!cell.isMultiplier &&
              cell.id !== "scatter" &&
              winnerIds.includes(cell.id)) {
            grid[r][c] = null;
            removed++;
          }
        }
      }
      return removed;
    }

    function dropSymbols() {
      for (let c = 0; c < COLS; c++) {
        const columnCells = [];
        for (let r = 0; r < ROWS; r++) {
          if (grid[r][c]) {
            columnCells.push(grid[r][c]);
          }
        }
        while (columnCells.length < ROWS) {
          columnCells.unshift(createRandomCell());
        }
        for (let r = 0; r < ROWS; r++) {
          grid[r][c] = columnCells[r];
        }
      }
    }

    function spawnMultipliersRandom() {
      const chance = currentSpinIsFree ? MULT_CHANCE_FREE : MULT_CHANCE_BASE;
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = grid[r][c];
          if (!cell || cell.isMultiplier || cell.id === "scatter") continue;
          if (Math.random() < chance) {
            cell.isMultiplier = true;
            cell.multValue = randChoice(MULTIPLIER_VALUES);
          }
        }
      }
    }

    function getTotalMultiplier() {
      let total = 0;
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = grid[r][c];
          if (!cell || !cell.isMultiplier || cell.multValue <= 0) continue;
          total += cell.multValue;
        }
      }
      return total;
    }

    function clearMultipliers() {
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = grid[r][c];
          if (!cell) continue;
          if (cell.isMultiplier) {
            cell.isMultiplier = false;
            cell.multValue = 0;
          }
        }
      }
    }

    async function tumbleSequence() {
      let totalWin = 0;
      let chainIndex = 0;

      while (true) {
        const { winnerIds } = findWinningSymbols();
        if (winnerIds.length === 0) break;

        chainIndex++;
        elInfo.textContent = chainIndex + ". tumble!";
        renderGrid(winnerIds);
        await wait(400);

        const removed = removeWinningSymbols(winnerIds);

        const multiplierSum = getTotalMultiplier();
        const basePerSymbol = bet * 0.25;
        let winThisTumble = removed * basePerSymbol;
        if (multiplierSum > 0) {
          winThisTumble *= multiplierSum;
        }
        winThisTumble = Math.round(winThisTumble);

        totalWin += winThisTumble;

        clearMultipliers();

        dropSymbols();
        spawnMultipliersRandom();

        renderGrid();
        await wait(300);
      }

      return totalWin;
    }

    async function spin() {
      if (spinning) return;
      if (bet <= 0) return;

      const isFree = freeSpins > 0 && freeSpinSessionActive;
      currentSpinIsFree = isFree;

      if (!isFree && balance < bet) {
        elInfo.textContent = "";
        elWinInfo.innerHTML = "<span class='danger'>Yetersiz bakiye.</span>";
        return;
      }

      spinning = true;
      elSpin.disabled = true;
      elBuy.disabled = true;
      elWinInfo.textContent = "";

      if (isFree) {
        freeSpins--;
        elInfo.textContent = `FREE SPIN! Kalan: ${freeSpins}`;
      } else {
        elInfo.textContent = "D√∂n√ºyor...";
        balance -= bet;
      }
      updateUI();

      initGrid();
      spawnMultipliersRandom();
      renderGrid();

      const scatterCount = countScatters();

      await wait(400);

      const totalWin = await tumbleSequence();

      if (totalWin > 0) {
        balance += totalWin;
        updateUI();

        if (freeSpinSessionActive && isFree) {
          // Free spin serisinde: sadece toplama ekle, spin ba≈üƒ±na kazancƒ± yazma
          freeSpinSessionTotalWin += totalWin;
          elWinInfo.textContent = "";
        } else {
          // Normal spin: kazancƒ± direkt g√∂ster
          elWinInfo.innerHTML =
            `<span class="ok">Toplam kazan√ß: ${totalWin} kredi</span>`;
        }
      } else {
        if (!freeSpinSessionActive || !isFree) {
          elWinInfo.textContent = "Bu elde kazan√ß yok.";
        }
      }

      // Free spin kazanƒ±mƒ± (scatter ile)
      if (scatterCount >= 4) {
        const extra = Math.max(0, scatterCount - 4);
        const awardedFS = 10 + extra * 2;
        freeSpins += awardedFS;

        if (!freeSpinSessionActive) {
          freeSpinSessionActive = true;
          freeSpinSessionTotalWin = 0;
        }
        updateUI();

        const freeMsg = isFree
          ? `Free spin i√ßinde ${awardedFS} ekstra free spin kazandƒ±n!`
          : `${awardedFS} free spin kazandƒ±n!`;

        elWinInfo.innerHTML += `<br><span class="ok">${freeMsg}</span>`;
      }

      // Free spin serisi bittiyse toplam kazancƒ± yaz
      if (freeSpinSessionActive && isFree && freeSpins === 0) {
        elInfo.textContent = "Free spinler bitti.";
        elWinInfo.innerHTML =
          `<span class="ok">Free Spin Toplam Kazan√ß: ${freeSpinSessionTotalWin} kredi</span>`;
        freeSpinSessionActive = false;
      } else if (!isFree && !freeSpinSessionActive) {
        elInfo.textContent = "";
      }

      spinning = false;
      elSpin.disabled = false;
      updateUI();

      // Free spin serisi devam ediyorsa otomatik sƒ±radaki spini ba≈ülat
      if (freeSpinSessionActive && freeSpins > 0) {
        setTimeout(() => {
          spin();
        }, 600);
      }
    }

    // Free Spin satƒ±n alma: bahis √ó100 maliyet, 10 free spin, otomatik seri
    function buyFreeSpins() {
      if (spinning) return;
      const cost = bet * 100;
      if (cost <= 0) return;

      if (balance < cost) {
        elInfo.textContent = "";
        elWinInfo.innerHTML = "<span class='danger'>BUY i√ßin yetersiz bakiye.</span>";
        return;
      }

      balance -= cost;
      freeSpins += 10;
      freeSpinSessionActive = true;
      freeSpinSessionTotalWin = 0;
      updateUI();

      elInfo.textContent = `BUY ile 10 free spin aldƒ±n!`;
      elWinInfo.textContent = "";

      spin(); // ilk free spin otomatik ba≈ülasƒ±n
    }

    // Bahis kontrol
    elBetMinus.addEventListener("click", () => {
      if (spinning) return;
      if (bet > 10) {
        bet -= 10;
        updateUI();
      }
    });

    elBetPlus.addEventListener("click", () => {
      if (spinning) return;
      if (bet < 200) {
        bet += 10;
        updateUI();
      }
    });

    elSpin.addEventListener("click", spin);
    elBuy.addEventListener("click", buyFreeSpins);

    // Ba≈ülat
    initGrid();
    updateUI();
    renderGrid();
  </script>
</body>
</html>